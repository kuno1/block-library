!function(e){var t={};function r(a){if(t[a])return t[a].exports;var l=t[a]={i:a,l:!1,exports:{}};return e[a].call(l.exports,l,l.exports,r),l.l=!0,l.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)r.d(a,l,function(t){return e[t]}.bind(null,l));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}({4:function(e,t,r){e.exports=r(5)},5:function(e,t){
/*!
 * wpdeps=wp-blocks,kbl,wp-block-editor, wp-components, wp-api-fetch, kbl-components-user-selector, kbl-components-post-selector
 */
var r=wp.blocks.registerBlockType,a=wp.i18n,l=a.__,n=a.sprintf,o=wp.blockEditor,c=o.RichText,i=o.withColors,s=o.InspectorControls,u=o.PanelColorSettings,b=o.MediaUpload,m=o.MediaUploadCheck,p=wp.components,f=p.Button,d=p.PanelBody,h=p.SelectControl,g=p.TextControl,v=wp.compose.withState,k=kbl,y=k.UserSelector,R=k.PostSelector,E={},C={},S=function(e){for(var t="",r=0,a=["thumbnail",KblBubble.size];r<a.length;r++){var l=a[r];e.sizes[l]&&(t=e.sizes[l].url)}return t},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";wp.data.dispatch("core/notices").createNotice(t,e,{isDismissible:!0})};r("kunoichi/bubble",{title:l("Speech Bubble","kbl"),icon:"format-chat",category:"formatting",description:l("Speech bubble with avatar.","kbl"),attributes:{position:{type:"string",default:"left"},name:{type:"string",default:""},avatar:{type:"string",default:""},writer:{type:"integer",default:0},user:{type:"integer",default:0},textColor:{type:"string",default:""},backgroundColor:{type:"string",default:""},content:{type:"array",source:"children",selector:"p"}},edit:v({src:KblBubble.avatar,name:""})(i("backgroundColor","textColor")((function(e){var t=e.attributes,r=e.setAttributes,a=e.backgroundColor,o=e.setBackgroundColor,i=e.textColor,p=e.setTextColor,v=e.src,k=e.setState,N=name,_=v;if(t.user){var x=E[t.user];x?(N=x.display_name,_=x.avatar):wp.apiFetch({path:n("kbl/v1/users/search?id=%d",t.user)}).then((function(e){e.length?(E[t.user]=e[0],k({name:e[0].display_name,src:e[0].avatar})):(r({user:0}),w(l("User not found.","kbl"),"error"))})).catch((function(e){var t=l("Error","kbl");e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),w(t,"error")}))}else if(t.writer){var O=C[t.writer];O?(N=O.title,_=O.thumbnail):wp.apiFetch({path:n("kbl/v1/search/%1$s?id=%2$d",KblBubble.virtual_member,t.writer)}).then((function(e){e.length?(C[t.writer]=e[0],k({name:t.name?t.name:e[0].title,src:t.avatar?t.avatar:e[0].thumbnail})):(r({writer:0}),w(l("Post not found.","kbl"),"error"))})).catch((function(e){var t=l("Error","kbl");e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),w(t,"error")}))}t.name.length&&(N=t.name),t.avatar&&(_=t.avatar);var B=[{value:i.color,label:l("Text Color","kbl"),onChange:p},{value:a.color,label:l("Background Color","kbl"),onChange:o}],P=["kbl-bubble-text"],T={};return a.class?P.push(a.class):a.color&&(T.backgroundColor=a.color),i.class?P.push(i.class):i.color&&(T.color=i.color),React.createElement(React.Fragment,null,React.createElement(s,null,React.createElement(d,{title:l("Speaker","kbl"),initialOpen:!0},React.createElement("hr",{style:{marginTop:0}}),React.createElement("h4",{className:"kbl-user-heading"},l("Input Directly","kbl")),React.createElement(g,{label:l("Name","kbl"),value:t.name,help:l("If name is empty, this will be just omitted.","kbl"),onChange:function(e){return r({name:e})}}),React.createElement(m,null,React.createElement(b,{allowedTypes:["image"],onSelect:function(e){r({avatar:S(e)})},render:function(e){var a=e.open;return React.createElement(React.Fragment,null,React.createElement(f,{isDefault:!0,onClick:a},l("Select Avatar","kbl")),t.avatar&&React.createElement(f,{style:{marginLeft:"10px"},isLink:!0,onClick:function(){return r({avatar:""})}},l("Clear Avatar","kbl")))}})),React.createElement("hr",null),React.createElement(y,{id:t.user,currentLabel:l("Specify WordPress User","kbl"),label:l("Search from WordPress users","kbl"),onChange:function(e){return r({user:e,writer:0})}}),KblBubble.virtual_member&&React.createElement(React.Fragment,null,React.createElement("hr",null),React.createElement(R,{id:t.writer,postType:KblBubble.virtual_member,currentLabel:n(l("Specify %s","kbl"),KblBubble.virtual_member_label),label:n(l("Search from %s","kbl"),KblBubble.virtual_member_label),onChange:function(e){return r({writer:e,user:0})}}))),React.createElement(d,{title:l("Layout","kbl"),initialOpen:!1},React.createElement(h,{label:l("Position","kbl"),value:t.position,options:[{label:l("Left","kbl"),value:"left"},{label:l("Right","kbl"),value:"right"}],onChange:function(e){r({position:e})}})),React.createElement(u,{title:l("Color Setting","kbl"),colorSettings:B,initialOpen:!1})),React.createElement("div",{className:"kbl-bubble","data-position":t.position},_?React.createElement("div",{className:"kbl-bubble-avatar"},React.createElement("img",{className:"kbl-bubble-image",src:_,alt:N,width:96,height:96}),N.length?React.createElement("span",{className:"kbl-bubble-name"},N):null):null,React.createElement("div",{className:"kbl-bubble-body"},React.createElement(c,{className:P.join(" "),style:T||null,tagName:"p",value:t.content,placeholder:l("Enter speech here.","kbl"),onChange:function(e){return r({content:e})}}))))}))),save:function(e){var t=e.attributes;return React.createElement("div",{className:"kbl-bubble-body"},React.createElement(c.Content,{tagName:"p",className:"kbl-bubble-text",value:t.content}))}})}});
//# sourceMappingURL=bubble.js.map